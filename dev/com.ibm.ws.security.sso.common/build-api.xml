<project name="com.ibm.ws.security.sso.common-api" default="buildApiWithApiBnd"> 
  <!-- DO NOT CHANGE THE DEFAULT TASK FROM 'buildApiSpi'
       Top level builds use this task explicity.  Changing the
       default will create an incompatibility between a default
       project build and a top level build. -->
       
  <!-- IBM-API required properties. -->
  <property name="apibndfile" value="${basedir}/build/api.bnd"/>
  <property name="api.ibm.packages" value="${basedir}/build/api.ibm.packages" />
  <property name="bundleName" value="WebSphere SAML web single sign-on API" />
  <property name="api.ibm.symbolic.suffix" value="saml20" />
  <property name="api.ibm.version" value="1.1"/>
    
  <property name="feature.name" value="com.ibm.websphere.appserver.ssoCommon-1.0"/>

  <property name="additional.javadoc.src.dirs" value=""/>

  <import file="../ant_build/public_imports/apibnd_imports.xml"/>
  <import file="../ant_build/public_imports/internal_imports/wlpbnd.xml"/>
  
  <target name="buildApiWithApiBnd" depends="genDevJars, overrideApiBnd, genDevSchema, genDevJavadoc, publish.determineWhatToDo, publish.publishDev"/>
  
  <target name="overrideApiBnd">
        <echo message="pom:${dev.api.ibm.dir}/${api.ibm.pom}" />
        <echo message="override: delete ${dev.api.ibm.output.dir}/${api.ibm.output.jar}"/>
        <delete file="${dev.api.ibm.output.dir}/${api.ibm.output.jar}" />
        <bndOutputJar file="${basedir}/api.bnd" property="api.ibm.output.jar" versionProperty="bVersion" microVersion="${micro.version}" useGlobalMicro="${use.global.micro}"/>

        <echo message="override: IBM-API output jar (api.ibm.output.jar): ${api.ibm.output.jar}"/>
        <echo message="override: IBM-API output dir (dev.api.ibm.output.dir): ${dev.api.ibm.output.dir}"/>
        <echo message="override: ${dev.api.ibm.output.dir}/${api.ibm.output.jar}"/>
      	<!--  <bnd> apparently tolerates absent files on classpath string, but not on classpathref. So: -->
	<!-- It also has problems with comma as delimiter, despite claims -->
        <wlpbnd eclipse="false"
             failok="false"
             exceptions="true"
 	         classpathref="bnd.classpath"
             output="${dev.api.ibm.output.dir}/${api.ibm.output.jar}"
             files="${basedir}/api.bnd"/>        
  </target>
  
</project>
